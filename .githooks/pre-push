#!/bin/bash
# Git pre-push hook - Runs quality checks before allowing push
# 
# Installation:
#   chmod +x .githooks/pre-push
#   git config core.hooksPath .githooks
#
# Or copy to .git/hooks/:
#   cp .githooks/pre-push .git/hooks/
#   chmod +x .git/hooks/pre-push

echo "üöÄ Running pre-push checks..."
echo ""

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Run lint checks (go vet and formatting)
echo "üìã Running code quality checks..."
if ! make lint; then
    echo ""
    echo -e "${RED}‚ùå Quality checks failed!${NC}"
    echo -e "${YELLOW}Fix issues before pushing:${NC}"
    echo "  - Run 'make fmt' to fix formatting"
    echo "  - Fix go vet issues manually"
    echo ""
    exit 1
fi

# Run unit tests (fast, no database needed)
echo ""
echo "üß™ Running unit tests..."
if ! make test-unit; then
    echo ""
    echo -e "${RED}‚ùå Unit tests failed!${NC}"
    echo -e "${YELLOW}Fix failing tests before pushing.${NC}"
    echo ""
    exit 1
fi

echo ""
echo -e "${GREEN}‚úÖ All pre-push checks passed!${NC}"
echo "Proceeding with push..."
echo ""

exit 0